import*as l from"https://ibelem.github.io/webnn-developer-preview/assets/dist_transformers/1.22.0-dev.20250325/transformers.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();const m="https://images.pexels.com/photos/5965592/pexels-photo-5965592.jpeg?auto=compress&cs=tinysrgb&w=1024",d=document.getElementById("status"),g=document.getElementById("upload"),s=document.getElementById("container"),p=document.getElementById("example");d.textContent="Loading model...";const f=await l.AutoModel.from_pretrained("webnn/RMBG-2",{config:{model_type:"custom"}}),h=await l.AutoProcessor.from_pretrained("webnn/RMBG-2",{config:{do_normalize:!0,do_pad:!1,do_rescale:!0,do_resize:!0,image_mean:[.5,.5,.5],feature_extractor_type:"ImageFeatureExtractor",image_std:[1,1,1],resample:2,rescale_factor:.00392156862745098,size:{width:1024,height:1024}}});d.textContent="Ready";p.addEventListener("click",n=>{n.preventDefault(),A(m)});g.addEventListener("change",function(n){const t=n.target.files[0];if(!t)return;const r=new FileReader;r.onload=a=>A(a.target.result),r.readAsDataURL(t)});async function A(n){const t=await l.RawImage.fromURL(n);s.innerHTML="",s.style.backgroundImage=`url(${n})`;const r=t.width/t.height,[a,e]=r>720/480?[720,720/r]:[480*r,480];s.style.width=`${a}px`,s.style.height=`${e}px`,d.textContent="Analysing...";const{pixel_values:o}=await h(t),{output:i}=await f({input:o}),u=await RawImage.fromTensor(i[0].mul(255).to("uint8")).resize(t.width,t.height);t.putAlpha(u);const c=document.createElement("canvas");c.width=t.width,c.height=t.height,c.getContext("2d").drawImage(t.toCanvas(),0,0),s.append(c),s.style.removeProperty("background-image"),s.style.background='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURb+/v////5nD/3QAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAUSURBVBjTYwABQSCglEENMxgYGAAynwRB8BEAgQAAAABJRU5ErkJggg==")',d.textContent="Done!"}
